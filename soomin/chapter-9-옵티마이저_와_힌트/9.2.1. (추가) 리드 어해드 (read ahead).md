---
tags:
  - 데이터베이스
  - cs
parent: "[[InnoDB 아키텍처]]"
related: 
created: 2025-06-25
---

# 0. 학습 목적
- 리드 어헤드가 뭐하는 작업인지 이해한다.
- 리드 어헤드가 왜 필요한지 이해한다.

# 1. 리드 어헤드 (Read - Ahead)란? 
**`InnoDB 엔진`** 이 어떤 데이터가 필요할 것이란 것을 **미리 예측해서 버퍼 풀에 적재**해두는 작업을 의미한다.

## (1) 특징
- 백그라운드 스레드가 비동기적으로 진행
- `한 번에`, `많이`, `미리` 필요한 것들을 읽어 온다.

## (2) 리드 어헤드가 필요한 이유? 
**빠른 데이터 읽기를 위하여**

table full scan 처럼 대량의 레코드 읽기 요청이 들어오면, MyISAM 같은 옛날 형식 엔진들은 디스크에서 페이지를 하나씩 읽어오며 이를 처리했다. 당연히 이것의 테이블이 여러 개의 페이지에 걸쳐 저장되어 있을 수록 느리다.

이 단점을 커버하기 위해 InnoDB에서는 리드 어헤드 방식을 만들었다.
대량의 읽기 작업이 필요한 상황을 대비하여, 디스크에서 필요할 것 같은 페이지들을 **한 번에, 많이, 미리** 읽어서 메모리 버퍼 풀에 적재하여 놓는다. 그 방법에는 2가지가 있다.

# 2. 리드 어헤드의 종류 

## (1) 선형 리드 어헤드 (Linear read-ahead)
순차 접근 페이지 수가 특정 임계치를 넘었을 경우, 1 Extent를 한번에 읽어와서 메모리 버퍼풀에 저장해두는 리드 어헤드

### A. 과정
0. 세팅: `innodb_read_ahead_threshold` 라는 값을 설정한다. 해당 값은 리드 어헤드가 발동해야 하는 읽는 페이지 수 임계치이다. 해당 임계치 이상 페이지를 읽을 경우 linear-read-ahead가 작동한다.
   
1. 임계치 이하의 작업은 요청을 할당 받은 포그라운드 스레드가 작업한다.
   
2. innodb가 순차 접근 요청으로 메모리 버퍼 풀에 적재된 페이지 수를 보았을 때, `innodb_read_ahead_threshold`의 값과 동일해진다면, linear-read-ahead 가 발동한다.
   
3. 디스크 읽기 작업 주체가 `포그라운드 스레드`에서 `백그라운드 스레드`로 넘어가고, 백그라운드 스레드가 해당 페이지 이후의 64개의 페이지를 읽어서 메모리에 적재해둔다. 
   (만약 임계치 = 48, 요청에 필요한 페이지 수가 49개 였더라도, 선형 리드 어헤드는 다음 64개를 읽어서 가져온다. 즉 포그라운드가 48개 , 백그라운드가 64개 총 112개의 페이지를 읽어서 메모리에 적재시킨 것이다.)

### B. 임계치 설정 TIP
- 데이터 읽기 요청이 많은 데이터 웨어 하우스 용으로 DB를 쓰고 있다면 해당 임계치를 낮춰서, 백그라운드 스레드의 리드 어헤드 트리거 시점이 빨라지도록 하는 것이 성능 측면에서 좋다.

## (2) 랜덤 리드 어헤드 (Random read-ahead)
메모리 버퍼 풀에 같은 extent 내의 연속된 페이지가 특정 임계치 이상 저장되어 있다면, 해당 extent 내의 나머지 page도 모두 메모리 버퍼풀에 적재하는 리드 어헤드

- 기존에 적재된 연속된 페이지들의 읽어지는 순서는 랜덤 리드 어헤드에 영향을 주지 않는다. (그저 연속된 페이지이면 됨) 
- `innodb_random_read_ahead = ON`을 키면 사용 가능

해당 임계치를 사용자가 설정할 수 있는지는 모르겠다. (공식 문서에도 안 나옴) 

공식 문서의 예시

- 만약 특정 시점에 같은 extent 내의 연속된 페이지 13개가 메모리 버퍼 풀에 올라와 있다면,
- InnoDB 엔진이 비동기적으로 익스텐트 내의 나머지 페이지들에 대한 메모리 적재 작업 요청을 발행한다.
- 백그라운드 스레드가 이를 감지하고 해당 작업을 시행한다.

# 핵심 요약
- 리드 어헤드는 필요할 것 같은 페이지들을 미리 한번에 많이 메모리 버퍼 풀에 적재하는 비동기 디스크 읽기 작업이다.
- 선형 리드 어헤드는 디스크 순차 접근 페이지 수가 특정 임계치를 넘었을 때, 발동되고, 백그라운드 스레드가 디스크 읽기 작업을 위임 받아서, 다음 64개의 Page(1 extent)를 읽어서 메모리에 적재시킨다.
- 랜덤 리드 어헤드는 하나의 익스텐드 내의 연속된 페이지 수가 특정 임계치를 넘어서면 inndb가 비동기적으로 해당 익스텐트의 나머지 페이지를 읽어서 메모리에 적재시키는 방식이다.

---

# Metadata

### A. 모르는 단어 정리 
- `table space`
  : 테이블 저장을 논리적으로 나타내는 최상위 단위
- `Segement`
  : table space의 영역을 논리적으로 나눈 것
   Segement는 다시 여러 개의 Extent로 나뉜다.
	- NON-LEAF NODE Segement:  리프노드로 가는 경로 노드들을 저장한 영역
	- LEAF NODE Segement: 리프노드(실 데이터 저장소)를 저장한 영역
- `Extent`
  : 64개의 Page를 뜻한다.

테이블을 디스크에 저장할 때, 저장의 계층 구조 
![image.png](https://raw.githubusercontent.com/dalcheonroadhead/img-cloud/main/2025-06/20250625125519.png)

###  B. 참고 문서
- [17.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)](https://dev.mysql.com/doc/refman/8.4/en/innodb-performance-read_ahead.html)
- [MYSQL Read Ahead에 대해서 알아보자 - 알쓸 코지](https://coji.tistory.com/151)
- [Why linear read ahdea (prefetch) may improve performance](https://dba.stackexchange.com/questions/311766/why-linear-read-ahead-prefetch-may-improve-performance)

### C. 관련 글

```dataview
TABLE without id file.inlinks AS "BackLink"
WHERE file.path = this.file.path
```

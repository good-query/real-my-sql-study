---
tags:
  - 데이터베이스
  - cs
parent: "[[소트 버퍼 (Sort Buffer)]]"
related: 
created: 2025-06-25
---

# 0. 학습 목적
- 결과 데이터 정렬 시, 정렬 알고리즘에는 무엇이 있는지 이해한다. 
- 정렬 알고리즘의 원리를 이해한다.
- 어떤 상황에서 어떤 알고리즘이 사용되는지 이해한다.

# 1. 결과 레코드 정렬 알고리즘이란? 
정렬이 실행 계획 상 `using filesort` 로 이루어질 떄 활용되는 알고리즘.
소트 버퍼에 무슨 데이터를 올리느냐에 따라서 나뉜다.

- 투 패스(<sort key, rowid>)
  : 소트 버퍼에 레코드 별로 그것의 정렬 키와 로우 아이디만 적재하는 방식
  
- 싱글 패스
  : 소트 버퍼에 레코드 별로 그것의 정렬 키와 레코드 값 전체를 적재하는 방식
  레코드의 크기를 고정적인 사이즈로 저장하냐, 가변적인 사이즈로 저장하느냐에 따라 다음과 같이 나뉨.
	- 고정적 싱글 패스  (<sort_key, additional_fields>)
	- 가변적 싱글 패스 (<sort_key, packed_additional_fields>) 

> [!info] 참고 정보
> - 투 패스와 싱글 패스라는 이름은 `real-my-sql` 저자가 임의로 지은 것이다.
> - 저 방식 중 무엇으로 file sorting이 되었는지 확인하려면, 옵티마이저의 trace 기능을 활성화 하고, 트레이스 내용에서 sort_algorithm이라는 부분에 무엇을 썼다고 기록되었는지를 봐야 한다.
> - 기록은 각 알고리즘 옆에 괄호 부분 내용 형태로 쓰여져 있다.

# 2. 싱글 패스 정렬 방식
결과값 레코드 전체를 소트 버퍼에 올려서 정렬 후, 그 결과를 바로 반환함.

# 3. 투 패스 정렬 방식
- 정렬 대상이 되는 칼럼과 레코드의 PK 값만 소트 버퍼에 올려서 정렬 진행
- 정렬을 완료한 후, 각 레코드의 PK마다 다시 본 테이블에 랜덤 접근을 하여 필요한 컬럼값들으 가져오고 JOIN
- 그 결과를 반환

# 4. 활용처
- 일반적으로 싱글 패스를 활용한다.
  : 투 패스는 테이블 두 번 읽어야 해서, 웬만한 상황에서는 싱글 패스보다 비용적, 시간적 효율이 떨어지기 때문이다.
하지만 다음 경우에는 투 패스를 활용한다.

### (1) 투 패스 방식을 활용하는 경우
- 레코드 크기가 `max_length_for_sort_data` 라는 시스템 설정 변수 값보다 큰 경우
- `BLOB`, `TEXT` 등 대용량 컬럼을 포함하는 테이블일 경우

위의 경우들은 싱글 패스 사용 시 소트 버퍼에 적재할 수 있는 레코드 수가 급감하기 때문에, 
`Multi-merge 비용` > `테이블 2 번 읽는 비용` 이 되기 때문에 투 패스 방식을 활용한다.

# 핵심 요약

---

# Metadata

### A. 모르는 단어 정리 

###  B. 참고 문서

### C. 관련 글

```dataview
TABLE without id file.inlinks AS "BackLink"
WHERE file.path = this.file.path
```

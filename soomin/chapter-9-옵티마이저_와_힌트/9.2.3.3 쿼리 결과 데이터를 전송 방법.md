---
tags:
  - 데이터베이스
  - cs
parent: "[[InnoDB 아키텍처]]"
related: 
created: 2025-07-04
---

# 0. 학습 목적
- 쿼리 처리가 된 데이터를 클라이언트에게 전송하는 방식에 대해서 안다.

# 1. 스트리밍 방식
서버 쪽에서 쿼리를 만족하는 레코드를 찾을 때마다 바로바로 클라이언트에게 전송하는 방식 

### (1) 장점
1. 사용자가 데이터 반환 값을 보기까지의 시간이 짧아서, 좋은 사용자 경험을 제공할 수 있다. 
2. `limit` 키워드를 사용하면, 조회해야 할 데이터 양이 줄어들기 때문에 큰 성능적 이득을 볼 수 있다.

### (2) 제약사항
- `ORDER BY`, `GROUP BY`와 같이 전체 데이터를 읽은 뒤 후처리 해야하는 쿼리문에서는 스트리밍 방식을 활용하지 못한다.
  (단 `인덱스를 활용한 정렬`로 정렬 방식을 택했다면, 스트리밍 방식이 가능하다. - 이미 정렬되어 있기 때문)

# 2. 버퍼링 방식
`ORDER BY`, `GROUP BY` 와 같이 전체 데이터를 읽은 후, 후처리 해야하는 작업에 대해서 사용하는 쿼리 전송 방식으로, **전체 데이터 가공이 끝난 뒤에, 한 번에 보낸다.**

### (1) 특성
1. 스트리밍 방식보다 응답 속도가 느리다. (전체 데이터 가공을 마친 뒤에야 차례대로 보내기 때문에)
2. 위와 같은 이유로 `limit`을 사용해도 큰 성능적 향상을 경험할 수 없다. (어짜피 전체 데이터를 가공한 후 잘라내는 것이기 때문에, 스트리밍 방식처럼 처음부터 읽을 데이터를 한정하여 읽는 것보다 훨씬 느리다.)

# 3. DB에서 스트리밍 처리를 해도, 고객이 못 느끼는 이유
클라이언트가 데이터를 버퍼링 형식으로 다 받기를 기다렸다가 전체 내용을 한 번에 고객에게 재전송하는 형태라면, 아무리 DB에서 스트리밍 처리를 했다해도, 사용자는 버퍼링 방식으로 데이터를 받은 것 처럼 느낄 수 있다.

예로 **JDBC**를 들어보겠다.
JDBC는 DB로부터 데이터를 스트리밍 방식으로 받더라도, 내부 버퍼에 계속 채워넣기만 한다. 이후 전체 데이터 전송이 끝나면, 그때서야 버퍼의 내용을 클라이언트에게 재전송하는 방식이다. 따라서 JDBC를 사용한다면, DB가 스트리밍 방식을 쓰더라도, 사용자는 버퍼링 방식으로 데이터를 받게 된다.

### (1) 왜 JDBC는 버퍼링으로 데이터를 받을까? 
- 클라이언트와 DB 서버의 통신 횟수를 줄여서 자원 소모가 줄어듦 
- 클라이언트와 DB 서버간의 통신 횟수가 작으니까, 전체 처리량이 최소화된다.

> [!info] 참고
> 위에서 나온 스트리밍 방식과 버퍼링 방식에 대한 정의는 이론적으로 추상화된 것이고, 실제 구현은 조금 차이가 있다.
> 먼저 **스트리밍 방식 같은 경우**에, `real-my-sql` 책에서는 조건에 맞는 레코드를 찾을 때마다 바로바로 클라이언트에게 전송한다고 하였으나, 실제로는 유효한 레코드를 찾을 때마다 DB 서버의 네크워크 송신 버퍼에 데이터를 적재한다. 이후 해당 버퍼가 가득차면, DB의 쿼리 처리가 끝나지 않았더라도 데이터를 전송한다.
> 반면 **버퍼링 방식**은 쿼리 처리가 끝날 때까지는 버퍼를 일체 사용하지 않고, 쿼리 처리가 끝난 후 데이터 전체를 일괄 버퍼에 적재한 후 데이터를 보낸다. 

> [!example] 예시
 스트리밍 방식은 송신 버퍼 크기를 버퍼링 방식보다 작게 해둔다. 따라서 전체 전송 데이터 양이 1000이면, 버퍼 크기를 10정도로 해두고, 100번 왕복하는 것이다. 다만 쿼리 처리 중에도 버퍼가 가득차면 클라이언트에게 즉시 전송하니까, 사용자가 데이터를 받는 시간 자체는 짧다. 
> 다만, 모든 네트워크 패킷 전송마다 ACK 패킷과 SYN 패킷등을 주고 받아야 하기에, 네트워크 부하가 커진다.
> 버퍼링 방식은 버퍼 크기를 500 정도 훨씬 키운다. 따라서 쿼리 처리가 완료된 이후 1000이란 데이터 패킷 양을 단 두번의 전송으로 사용자에게 전부 보낼 수 있게 된다.

# 핵심 요약
- DB의 쿼리 결과 데이터 전송 방식에는 스트리밍 방식과 버퍼링 방식으로 나뉘어진다.
- 스트리밍 방식은 쿼리 실행 도중에도 쿼리 조건에 들어맞는 레코드 발견 시 바로바로 사용자에게 전송하는 방식이다.
- 버퍼링 방식은 DB에서 쿼리 결과를 완벽히 만든 후, 일괄적으로 사용자에게 전송하는 방식이다. 
- 사용자 경험은 첫 데이터가 먼저 도착하는 스트리밍 방식이 더 좋을 수 있지만, 네트워크 부하도가 높을 수 있다. 반면 버퍼링 방식은 네트워크 부하도가 높지 않기 때문에, 전체 처리량은 더 우수하다.

---

# Metadata

### A. 모르는 단어 정리 

###  B. 참고 문서
- real-my-sql

### C. 관련 글

```dataview
TABLE without id file.inlinks AS "BackLink"
WHERE file.path = this.file.path
```

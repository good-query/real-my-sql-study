<h1 align='center'>6.1 페이지 압축</h1>

# 1️⃣ 원리

- 디스크에 저장할 때 압축, 읽을 때 해제
- 메모리에서는 항상 압축 해제된 데이터로 관리
- 압축할 때 압축된 파일의 크기가 얼마인지 예측이 되지 않는 문제가 있는데, 적어도 하나의 테이블은 동일한 크기의 페이지로 통일 되어야 함. 그래서 이 압축에 OS 별로 지원되는 펀치 홀 이라는 기능을 활용한다.

# 2️⃣ 펀치홀

- 데이터 압축 후 남는 빈 공간을 운영체제에 반납하는 기법
  예) 16KB > 7KB로 압축, 나머지 9KB는 반납

1. 16KB의 페이지를 압축 (압축 결과를 7KB라고 가정)
2. MySQL 서버는 디스크에 압축된 결과 7KB를 기록
   (이 때 해당 7KB에 9KB의 빈 데이터를 기록)
3. 디스크에 데이터를 기록한 후, 7KB 이후의 공간 9KB에 대해 펀치 홀을 생성
4. 파일 시스템은 7KB만 남기고, 7KB에 적어놓은 빈공간 (여기서는 9KB는 운영체제에 다시 반납)

### 문제점

- 파일 공간을 운영체제에 다시 반납하는 작업을 하기 위해서는 운영체제 뿐만 아니라 하드웨어 자체에서도 해당 기능을 지원해야 사용 가능함.
- 파일 시스템 관련 명령어가 아직 펀치 홀을 지원하지 못한다.
  - MySQL 서버의 데이터 파일이 해당 서버에서만 머물면 괜찮은데, 예를 들어 백업 및 복구 같은 과정을 하면, 실제 펀치 홀 적용 후 1GB 만 쓰면 되는 공간인데, 백업 파일로 넘어갈 때, 펀치홀 부분이 다시 데이터 파일로 채워져서 10GB 되어버리고, 복구 시 펀치홀 미적용 백업 파일이 그대로 적용 되어서 펀치홀을 쓰는 아무 이유가 없게 된다.




---
tags:
  - 데이터베이스
  - cs
parent: "[[전문 검색 인덱스]]"
related: 
created: 2025-06-04
---

# 0. 학습 목적
- 기껏 전문 검색 인덱스 만들어놓고, 못 쓰면 말짱 도루묵이다. 이번 챕터에서는 사용법을 배운다.

# 1. 전문 검색 인덱스 사용법
- 테이블 안에 전문 검색 대상 컬럼에 대하여 전문 검색 인덱스가 생성되어 있어야 한다.
- Query 문장에 전문 검색을 위한 문법인 **(`Match`… `AGAINST`)** 를 써야한다. 

## (1) 전문 검색 인덱스 생성
테이블을 생성하며 전문 검색 인덱스도 같이 생성해보겠다.
```sql
CREATE TABLE tb_test (
 doc_id INT,
 doc_body TEXT,
 PRIMARY KEY (doc_id),
 FULLTEXT KEY fx_docbody WITH PARSER ngram
)ENGINE=InnoDB;
```

## (2) 인덱스 활용
### A. 활용 안되는 경우
```sql
SELECT * FROM tb_test WHERE doc_body LIKE '%애플%';
```
- 애플이 들어간 단어를 찾고자 할 때, 위와 같이 해도 찾아진다.
- 다만 인덱스는 활용되지 않고 doc_body에 있는 모든 글자를 전부 순회하면서 찾는다. 

### B. 활용 되는 경우
```sql
SELECT * FROM tb_test
WHERE MATCH (doc_body) AGAINST ('애플');
```
- `MATCH(내용이 있는 컬럼명) AGAINST ('찾을 단어')`  형태로 사용한다.
- 이렇게 `MATCH() AGAINST ()` 문법을 써야지만, 인덱스가 활용된다.

### C. 세부 모드 
#### a. Natural Language Mode 
- 기본 모드
- 일반적인 자연어 검색용
- 가중치( 검색 값과의 유사도) 순으로 정렬된다.

#### b. Natual Language Mode With Query Expansion 
```sql
SELECT * 
FROM article
WHERE MATCH(title, body) AGAINST('애플' WITH QUERY EXPANSION);

```
- 검색된 상위 결과에서 추가 키워드를 자동 추출하여 재검색
- 더 많은 관련 문서들을 반환 가능하다.

**세부 동작**
1. 원래 쿼리로 검색 
	- 입력한 키워드(ex - 애플)로 기본 `FULL-TEXT` 검색을 먼저 수행
	- 가장 관련도 점수가 높은 상위 N개의 문서를 뽑는다. (N의 default는 20) 
	- 이 상위 N개의 문서를 의미있는 문서라고 가정한다.
	  
2. 키워드 추출  + 재검색
	- 의미있는 문서에서 자주 등장하는 단어들을 추출 (ex - database 검색 시, index, query, performance 등)
	- 이 추출된 단어들을 원래 키워드에 자동으로 추가해서 재검색 수행 

#### c. Boolean Mode
```sql
SELECT * 
FROM article
WHERE MATCH(title, body) AGAINST('+애플 -사과' IN BOOLEAN MODE);

```
- 논리 연산자를 활용하여 키워드의 존재 여부를 더욱 세밀하게 조절
- 정렬은 score 순이 아님 -> 기본대로 Primary Key 순으로 나온다.

| 연산자     | 의미                        |
| ------- | ------------------------- |
| `+`     | 반드시 포함                    |
| `-`     | 제외                        |
| `"`     | 정확한 문장 검색 (phrase search) |
| `*`     | 와일드카드 (prefix matching)   |
| `()`    | 그룹화                       |
| `>` `<` | 중요도 조정                    |
| ~       | 중요도 낮춤 (부정적 영향)           |

# 핵심 요약
- 전문 검색 인덱스를 활용하려면 테이블에 전문 검색 인덱스를 생성하고, 'MATCH () AGAINST ()' 문을 써야 한다.
- 인덱스 활용 모드는 크게 3가지로 나뉜다. 
	- NATURAL LANGUAGE MODE : 기본 모드 
	- NATURAL LANGUAGE MODE WITH QUERY EXTANSION: 관련 있는 단어들 기준 재검색 해서 결과값에 유사한 결과도 뜨도록
	- BOOLEAN MODE: 논리 연산자를 활용한 세밀한 조정

---

# Metadata

### A. 모르는 단어 정리 to Layman's term

###  B. 참고 문서
- real-my-sql 8.5

### C. 자식 글

```dataview
TABLE without id file.inlinks AS "BackLink"
WHERE file.path = this.file.path
```

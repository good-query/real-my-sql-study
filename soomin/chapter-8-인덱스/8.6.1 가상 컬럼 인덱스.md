---
tags:
  - 데이터베이스
  - cs
parent: "[[함수 기반 인덱스]]"
related: 
created: 2025-06-06
---

# 0. 학습 목적
- 가상 컬럼이 뭔지 이해한다.
- VIRTUAL과 STORED의 차이에 대해 이해한다.

# 1. 가상 컬럼이란? 
사용자가 직접 만들지 않고, MySQL 엔진이 테이블의 기존 값들과 함수 식으로 만들어내는 컬럼을 의미한다.  다음과 같이 만들 수 있다.

```sql
CREATE TABLE user (
	user_id BIGINT,
	first_name VARCHAR(10),
	last_name VARCHAR(10),
	full_name VARCHAR(30) AS CONCAT(first_name + ' ' + last_name) VIRTUAL
)
```

first_name과 last_name은 기본 컬럼이고, 이를 이용한 full name은 가상 컬럼이다. 이러면 first_name과 last_name만 넣으면 full_name은 자동으로 계산되어진다. 

가상 컬럼은 아예 새로운 컬럼이 만들어짐으로, 테이블 구조의 변형은 필연적으로 동반된다.

| 종류    | 일반 컬럼               | 가상 컬럼                                |
| :---- | :------------------ | :----------------------------------- |
| 계산 방식 | 개발자가 수동으로 값을 넣어줘야함. | 테이블의 기존 컬럼과 함수식을 활용해 mySQL이 자동으로 채워줌 |

### (1) 가상 컬럼의 필요성
- 변형된 컬럼 값을 활용한 빠른 조회를 위해 (index 활용 시) 
- 훨씬 수월한 데이터 동기화를 위해
- 훨씬 수월한 유지 보수를 위해

변형된 컬럼 값은 기본 컬럼 기반 인덱스를 활용할 수 없다. 이 때, 변형된 컬럼 기반 인덱스를 만들어두면, 해당 값을 검색 시 더 빠른 조회가 가능하다.

만약 full_name을 first_name과 last_name과 따로 아예 새로운 기본 컬럼으로 만들어둔다면, first_name, last_name 따로, full_name 따로 개발자가 수동 관리해야한다. 이것에 비해 가상 컬럼은 자동 동기화가 되기 때문에 더 수월한 데이터 동기화가 가능하다.

만약 trigger를 활용해 데이터 동기화의 자동화를 이루었다 하더라도, 동기화 함수와 동기화 대상이 따로 떨어져 있어서 유지 보수 시 신경 써야할 점이 많다. 가상 컬럼은 이를 하나로 통합하여 관리를 수월하게 해준다.

# 2. 가상 컬럼의 종류 

가상 컬럼 생성 옵션에는 `VIRTUAL`과 **`STORED`** 가 있다. 둘의 차이에 대해 알아보자.

| 종류                  | VIRTUAL 가상 컬럼                | STORED 가상 컬림                           |
| ------------------- | ---------------------------- | -------------------------------------- |
| 디스크 속 데이터 파일에 저장 여부 | 저장 X                         | 저장 O                                   |
| 컬럼 값 계산 시점          | SELECT 조회 시 하나 하나 그떄 계산 및 반환 | INSERT, UPDATE 시 계산 해서 디스크에 넣어둔다.      |
| 인덱스 가능 여부           | 가능                           | 가능                                     |
| 인덱스 저장 위치           | 디스크에 저장                      | 디스크에 저장                                |
| 성능                  | 조회 시 그때 만들어짐으로 상대적으로 느림      | 디스크에 저장된 미리 계산된 값들을 미리 긁어오기만 하면 되어서 빠름 |
| 공간 사용               | 인덱스 안 만들면 디스크 공간 아예 안씀       | 디스크의 데이터 파일에 저장 및<br>인덱스 만들면 인덱스로도 저장  |

VIRTUAL도 인덱스를 만들면 B-tree의 컬럼 키로 활용해야 하기에, STORED처럼 변형된 값들로 디스크에 저장됨을 유념하자.

STORED를 보면 기본 컬럼을 새로 만드는 것과 별 차이가 없다고 생각할 수 있겠다. 거의 비슷하지만, MySQL이 자동 동기화 해주느냐, 개발자가 수동 삽입해야하느냐의 차이일 것이다.

# 3. 가상 컬럼 인덱스란?
위에 만들어진 가상 컬럼으로 인덱스를 만드는 것이다. VIRTUAL이든 STORED든 인덱스로 생성되면 디스크에 B-tree 인덱스로 저장된다.

# 4. 핵심 요약
- 가상 컬럼은 사용자 개입 없이  MySQL이 자동으로 만들어주는 컬럼을 의미한다.
- 가상 컬럼은 변형된 컬럼 값으로 조회, 데이터 동기화, 유지보수에서 이점을 보인다.
- 생성 옵션에는 `VIRTUAL`과 `STORED` 로 나뉘며, 디스크에 계산된 값을 미리 저장하냐 아니냐가 큰 차이 이다.

---

# Metadata

### A. 모르는 단어 정리 to Layman's term

###  B. 참고 문서

### C. 자식 글

```dataview
TABLE without id file.inlinks AS "BackLink"
WHERE file.path = this.file.path
```

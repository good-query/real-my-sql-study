# 5. 역할 (Role)

### `KEY WORD`: 역할과 계정은 논리적 분리, 물리적 동일

## (1) 특징

- 역할을 만들고 그 역할이 수행할 수 있는 권한을 설정하지 않는다면, 역할은 그저 빈 껍데기가 된다. 마치 활성화된 서버가 올라가지 않은 VPC 와 같다.
- 역할별로 권한 설정을 꼭 해줘야 한다.

## (2) 역할과 계정의 관계

역할은 계정이 쓸 수 있는 도구이다. 
계정마다 `SET ROLE`을 활용하여 어떤 역할을 할 수 있는지 정해야 한다. 이는 DB를 재부팅할 때마다 초기화되며, 이것이 싫다면 `active_all_roles_on_login=ON`으로 초기화되지 않도록 설정해야 한다. 

  위 키워드에서도 말했듯이 역할과 계정은 논리적으로는 분리되어 있으나 물리적으로는 동일하다. 이것이 무슨 말이냐면 역할 또한 **계정 취급을 받으며 계정 테이블에 들어가 있다는 것이다.**

![image-20250305195932322](https://github.com/user-attachments/assets/49bc27ff-0dbb-4887-b4bc-dcf963dc7ec3)

### Q1. 그럼 뭐가 유저고 뭐가 역할인지 어떻게 구분하나요? 

구분할 필요 없음! 

![image-20250305201908984](https://github.com/user-attachments/assets/fff5f70b-d3f3-43de-a3c9-74c353705b82)

유저는 어짜피 USER라는 계정으로만 로그인 및 접속이 가능하다.  따라서 사실 유저는 ROLE을 같은 유저 객체라 인지해야하는 순간이 없음!

### Q2. `SET ROLE`은 어떻게 동작하나요? 

필자는 이렇게 착각했다.

![image-20250305205504323](https://github.com/user-attachments/assets/16c61a08-f2fa-452a-bac9-13da6beee1f7)

위 사진과 같이 계정이 ROLE을 바라보고 있는 `경로 지정형`이라 생각했지만, MySQL 내부 구조는 권한 병합 형태로 이루어진다. 즉 유저 객체 안으로 권한을 뜻하는 객체가 포함된다.

![image-20250305205612894](https://github.com/user-attachments/assets/06f1a129-ada9-4ae4-adda-b9d9bffb1ba2)

### Q3. 그러면 역할을 뜻하는 객체의 접속지점은 어디에 쓰이나요? 

역할을 뜻하는 객체 또한 물리적으로는 유저 테이블에 들어있기 때문에  `이름` + `@` + `유효한 접속 지점` 형태로 명명 되어 있다. 하지만 뒤에 유효한 접속 지점은 의미 없는 값이고, 항상 `% (모든 지점에서 사용 가능)` 이 붙어 있는 것이다. 


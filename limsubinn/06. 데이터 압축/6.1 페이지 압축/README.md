## 6.1 페이지 압축
MySQL 서버가 디스크에 저장하는 시점에 데이터 페이지가 압축되어 저장되고, 디스크에서 데이터 페이지를 읽어올 때 압축이 해제된다. <br>

16KB 데이터 페이지를 압축한 결과가 용량이 얼마나 될지 예측이 불가능한데 <br>
적어도 하나의 테이블은 동일한 크기의 페이지(블록)로 통일되어야 한다. <br>
그래서 페이지 압축 기능은 운영체제별로 특정 버전의 파일 시스템에서만 지원되는 **펀치 홀**이라는 기능을 사용한다. <br>

운영체제(파일 시스템)의 블록 사이즈가 512바이트인 경우, 페이지 압축이 작동하는 방식을 살펴보자. <br>
MySQL 서버는 특정 테이블에 대해 16KB 크기의 페이지를 유지하면서도 <br>
압축된 다양한 크기의 데이터 페이지를 디스크에 저장하고 압축된 만큼의 공간을 절약할 수 있다.
```
1. 16KB 페이지를 압축 (압축 결과를 7KB로 가정)
2. MySQL 서버는 디스크에 압축된 결과 7KB를 기록 (압축 데이터 7KB + 빈 데이터 9KB)
3. 디스크에 데이터를 기록한 후, 7KB 이후의 공간 9KB에 대해 펀치 홀 생성
4. 파일 시스템은 7KB만 남기고 나머지 디스크의 9KB 공간은 다시 운영체제로 반납
```

<img width="600" alt="image" src="https://github.com/user-attachments/assets/343a3492-68e2-4d11-8857-4dd91219afe7"> <br>

오른쪽 그림은 16KB 페이지에 대해 9KB만큼 펀치 홀이 생성된 것을 의미하는데, <br>
이 상태에서 실제 디스크의 공간은 7KB만 차지한다. <br>
하지만 운영체제에서 16KB를 읽으면 압축된 데이터 7KB와 펀치 홀 공간인 9KB를 합쳐 16KB를 읽는다. <br>

페이지 압축을 이용하기 위해서는 테이블을 생성하거나 변경할 때 `COMPRESSION` 옵션을 설정하면 된다. <br>
```sql
# 테이블 생성 시
mysql> CREATE TABLE t1 (c1 INT) COMPRESSION="zlib";
# 테이블 변경 시
mysql> ALTER TABLE t1 COMPRESSION="zlib";
mysql> OPTIMIZE TABLE t1;
```

<br>

펀치 홀 기능은 운영체제뿐만 아니라 하드웨어 자체에서도 해당 기능을 지원해야 사용 가능하다. <br>
또한, 아직 파일 시스템 관련 명령어가 펀치 홀을 지원하지 못한다. <br>
=> 따라서 실제 페이지 압축은 많이 사용되지 않는다.

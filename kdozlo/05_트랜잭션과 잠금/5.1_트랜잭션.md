# 5.1 트랜잭션
### 잠금
- 데이터베이스 엔진이 동시성 제어를 위해 특정 자원에 대한 접근 권한을 조절하는 메커니즘. 
- 격리 수준 구현, 교착 방지, 성능 고려 등이 필요

### 트랜잭션
- 하나 이상의 데이터 조작 작업을 하나의 논리적 단위로 묶어 ACID 속성을 보장하는 실행 단위

<br>

## 5.1.1 MySQL에서의 트랜잭션
- 논리적인 작업 셋 자체가 100% 적용되거나 아무것도 적용되지 않는 것을 보장해줘야함
    - 트랜잭션 원자성 보장
    - `COMMIT` -> 100% 적용
    - `ROLLBACK`or `오류` ->  아무것도 적용 X
- InnoDB에서는 트랜잭션 원자성 보장
- MyISAM에서는 트랜잭션 원자성 보장 X -> `Partial Update` 발생
    - 데이터 정합성 맞추기 어려움

## 5.1.2 주의사항
- 트랜잭션의 범위를 최소화하는 것이 좋다.
### 예시
```
[개선 전]
1. 처리 시작
   => 데이터베이스 커넥션 생성
   => 트랜잭션 시작
2. 사용자의 로그인 여부 확인
3. 사용자의 글쓰기 내용의 오류 여부 확인
4. 첨부로 업로드된 파일 확인 및 저장
5. 사용자의 입력 내용을 DBMS에 저장
6. 첨부 파일 정보를 DBMS에 저장
7. 저장된 내용 또는 기타 정보를 DBMS에서 조회
8. 게시물 등록에 대한 알림 메일 발송
9. 알림 메일 발송 이력을 DBMS에 저장
   <= 트랜잭션 종료(COMMIT)
   <= 데이터베이스 커넥션 반납
10. 처리 완료
```
- 실제 DBMS에 데이터 저장 작업은 5번부터 시작된다.
- 따라서 2, 3, 4의 경우 트랜잭션에 포함시킬 필요 X
    - 2, 3, 4 처리 동안 커넥션을 낭비하는 꼴!
- 8번 작업 또한 트랜잭션에서 불필요
    - 메일 전송이나 FTP 파일 전송 작업 또는 네트워크를 통한 통신 작업의 경우 -> **DBMS의 트랜잭션 내에서 제거하는게 좋다!!**
        - 프로그램 실행 동안 메일 서버와 통신할 수 없는 상황 발생 시, 웹 서버 뿐 아니라 DBMS서버까지 위험해질 가능성이 높아짐
- 5, 6번은 같은 트랜잭션으로 묶이는게 좋다.
- 7번의 경우 조회라서 트랜잭션 필요 X
- 9번의 다른 작업이라 트랜잭션을 별도로 분리

```
[개선 후]
1. 처리 시작
2. 사용자의 로그인 여부 확인
3. 사용자의 글쓰기 내용의 오류 발생 여부 확인
4. 첨부로 업로드된 파일 확인 및 저장
   => 데이터베이스 커넥션 생성(또는 커넥션 풀에서 가져오기)
   => 트랜잭션 시작
5. 사용자의 입력 내용을 DBMS에 저장
6. 첨부 파일 정보를 DBMS에 저장
   <= 트랜잭션 종료(COMMIT)
7. 저장된 내용 또는 기타 정보를 DBMS에서 조회
8. 게시물 등록에 대한 알림 메일 발송
   => 트랜잭션 시작
9. 알림 메일 발송 이력을 DBMS에 저장
   <= 트랜잭션 종료(COMMIT)
   <= 데이터베이스 커넥션 반납(또는 커넥션 풀에 반납)
```

<br>

# 5.1 추가 내용


# Natural Key
- 데이터베이스 설계에서 업무 도메인상 원래부터 존재하며 그 레코드를 식별할 수 있는 실질적인(“자연스러운”) 값을 PK로 사용하는 키
- 키 자체가 업무적 맥락(사번, 주민번호 등)을 담고 있음
- 자연적으로 유일해야 하지만, 시스템 차원에서 중복 방지를 위해 UNIQUE 제약을 추가로 설정

## Natural Key 장점
1. 추가 컬럼 불필요
    - 업무 식별자로 바로 조회 가능
2. 가독성, 디버깅 용이
    - 키 자체가 의미를 가지므로 로그·장애 분석 시 유리
3. 비즈니스 로직 재활용
    - 별도 매핑 과정 없이 업무 규칙을 그대로 활용

## Natural Key 단점
1. 변경 가능성
    - 업무 정책 변경(예: 사번 체계 리뉴얼) 시 PK 변경 부담
2. 크기 문제
    - 문자열·복합 키는 B-Tree 높이 증가 → 조회·조인 비용 상승
3. 보안
    - 주민등록번호 등 민감 정보 노출 우려
4. 분산, 병행 삽입 취약
    - 동시 다발적 생성 시 충돌 관리 로직 필요

## Natural Key 사용 시 고려사항
- 절대 불변성
    - “한 번 정해진 값은 절대 바뀌지 않는다”는 보장이 있어야 함
- 크기 최소화
    - 가능하면 8바이트 이내, 문자열일 땐 고정 길이·짧게
- 유일성 100% 보장
    - 업무 정책·외부 시스템과 연계해 중복 제로를 확실히
- 보안성 검토
    - 민감 정보는 PK로 부적합, 별도 토큰 발급 고려

<br>

# Surrogate Key

**인조 식별자 (Surrogate Key)**  
- 데이터베이스 설계에서 업무 도메인 자체와 무관하게, 시스템이 별도로 생성·부여하는 순수 식별용 키  
- 값 자체는 업무적 의미를 담지 않음

---

## 주요 유형
| 유형                     | 설명                            | 크기           | 특징                           |
| ---------------------- | ----------------------------- | ------------ | ---------------------------- |
| **AUTO\_INCREMENT 정수** | MySQL InnoDB 기본 제공            | 4\~8바이트 정수   | 순차적 증가 → 클러스터드 인덱스 친화        |
| **UUID v1/v4**         | 128비트(16바이트), 문자열 36자(하이픈 포함) | 128비트(16바이트) | v1: 시간 기반(순차성 일부), v4: 완전 랜덤 |
| **ULID**               | 128비트(16바이트), 문자열 26자         | 128비트(16바이트) | 시간 순서 보장 + 고유성, 문자열 길이 짧음    |


## 장점

1. **불변성 보장**  
   - 생성 후 변경될 일이 거의 없어 클러스터드 인덱스 안정적  
2. **크기·형식 통일**  
   - 모든 테이블에서 동일한 타입 사용 가능  
3. **업무 로직 독립**  
   - 도메인 정책 변화와 무관하게 PK 유지  
4. **분산 환경 적합**  
   - UUIDv1, ULID: 여러 서버에서 충돌 없이 동시 생성 가능  
   - *단, ULID도 동일 밀리초 내 다중 생성 시 충돌 가능 → 서버별 시퀀스 또는 충돌 회피 로직 고려*  
5. **보안 안전**  
   - PK 값 자체가 업무 의미를 담지 않으므로 외부 노출 시에도 추측 공격 위험 낮음  
   - *URL 등에 직접 노출할 때는 별도 난독화 또는 공개용 토큰(public ID) 발행을 권장*

---

## 단점

1. **업무 의미 부재**  
   - 로그·디버깅 시 “이 레코드가 무엇인지” 바로 파악 어려움  
2. **인덱스 단편화**  
   - 완전 랜덤 UUIDv4 사용 시 클러스터드 인덱스 페이지 분할 증가  
3. **크기 증가**  
   - UUID·ULID 등은 16바이트 이상 → 인덱스 및 조인 비용 상승  
4. **가독성 저하**  
   - 긴 식별자(특히 UUID 문자열) 확인이 불편  

---

## 사용 예시 및 가이드라인

- **일반 OLTP 시스템**  
  - AUTO_INCREMENT 정수(4~8바이트) 권장  
- **분산·병렬 삽입 환경**  
  - ULID 또는 UUIDv1: 시간 기반 순차성 보장 + 고유성  
  - 동시 다중 생성 시 충돌 회피 로직 필수  
- **보안·노출 민감 환경**  
  - 인조 식별자 사용으로 내부 정책·민감 정보 분리  
  - 추가로 공개용 토큰 발행 고려  
- **보조 업무 키 활용**  
  - 업무 의미가 필요한 조회·보고용으로 natural key 컬럼에 `UNIQUE` 제약을 걸어 보조적 사용  


# 개인 생각
### 웹 서버 개발시, Natural Key보다는 Surrogate Key를 사용하는 것이 좋다고 생각한다.
- 예상치 못한 변경에 대응이 더욱 쉽다.
- 분산 환경에서 유리하다.
- 민감 정보의 경우, Natural Key는 노출된다.
- 웹 환경에서는 Surrogate Key를 보통 가지고 있기 때문에 Natural Key로 조회하는 경우가 작다.
    - Natural Key로 조회하는 경우가 많다면 UNIQUE 제약 조건을 걸어서 인덱스를 생성하면 된다.
